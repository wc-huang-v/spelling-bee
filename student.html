<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å­¸ç”Ÿç·´ç¿’å€ v2.1</title>
    <style>
        /* --- ğŸ¨ å­¸ç”Ÿç‰ˆå°ˆå±¬é…è‰² (æ£®æ—æ¢éšªé¢¨æ ¼) --- */
        :root {
            /* èƒŒæ™¯ï¼šæº«æš–çš„ç±³è†šè‰²/æ¥µæ·ºç¶ ï¼Œåƒåœ–ç•«ç´™ */
            --bg-color: #f9fbe7; 
            
            /* ä¸»è‰²ï¼šæ£®æ—ç¶  (æ¨™é¡Œã€é‚Šæ¡†) */
            --primary: #2ecc71;  
            --primary-dark: #27ae60;
            
            /* å¼·èª¿è‰²ï¼šæ´»åŠ›æ©˜ (æŒ‰éˆ•ã€äº’å‹•) - å¼•å°é»æ“Š */
            --action: #f39c12;   
            --action-hover: #d35400;

            /* ç‹€æ…‹è‰² */
            --success-bg: #d5f5e3; /* å®Œæˆçš„æ ¼å­åº•è‰² */
            --success-text: #196f3d;
            --wrong: #e74c3c;

            /* æ–‡å­— */
            --text-main: #2c3e50; /* æ·±ç°è—ï¼Œå°æ¯”åº¦é«˜ */
            --text-light: #7f8c8d;

            /* ä»‹é¢ */
            --radius-card: 20px;
            --radius-btn: 50px;
            --shadow: 0 6px 0 rgba(0,0,0,0.1); /* ç«¥è¶£çš„åšé™°å½± */
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Microsoft JhengHei', 'Varela Round', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0; padding: 15px;
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh;
        }

        .app-container {
            width: 100%; max-width: 600px;
            background: #ffffff; 
            border-radius: var(--radius-card);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1); 
            overflow: hidden;
            border: 4px solid #fff; 
            min-height: 85vh; position: relative;
        }

        /* --- Header: æ´»æ½‘çš„åœ“å¼§è¨­è¨ˆ --- */
        header {
            background: var(--primary); color: white; padding: 15px 20px;
            font-size: 1.3rem; font-weight: 900;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 4px solid var(--primary-dark); /* ç«‹é«”æ„Ÿ */
        }

        .home-btn {
            background: rgba(255,255,255,0.2); border: 2px solid rgba(255,255,255,0.5); 
            color: white; padding: 6px 15px; border-radius: 20px; cursor: pointer; 
            font-size: 0.9rem; font-weight:bold; transition: 0.2s;
        }
        .home-btn:active { transform: scale(0.95); }

        .screen { padding: 25px; display: none; animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .screen.active { display: block; }
        @keyframes popIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }

        /* --- 1. é¦–é é¸å–® --- */
        .welcome-area { text-align: center; margin-bottom: 20px; margin-top: 10px; }
        .welcome-emoji { font-size: 4rem; margin-bottom: 10px; display: block; filter: drop-shadow(0 4px 0 #ddd); }
        
        /* å–®å…ƒé¸æ“‡ï¼šå¤§å¤§çš„åœ“è§’æ¡† */
        .session-select-area { 
            background: #f4f6f7; padding: 20px; border-radius: 20px; 
            border: 2px dashed #bdc3c7; margin-bottom: 25px; text-align: center;
        }
        select {
            width: 100%; padding: 15px; border-radius: 12px;
            border: 2px solid var(--primary); font-size: 1.2rem; 
            background: white; color: var(--text-main); font-weight: bold;
            outline: none; cursor: pointer;
            box-shadow: 0 4px 0 #eee;
        }

        .menu-grid { display: grid; gap: 15px; }
        
        .mode-card {
            background: white; border: 2px solid #eee; border-radius: 20px;
            padding: 20px; display: flex; align-items: center; gap: 20px;
            cursor: pointer; transition: 0.2s; box-shadow: 0 6px 0 #eee;
            position: relative; overflow: hidden;
        }
        .mode-card:active { transform: translateY(4px); box-shadow: 0 2px 0 #eee; }
        
        /* æ¨¡å¼é¡è‰²å€åˆ† */
        .mode-review { border-color: var(--primary); }
        .mode-review .icon-box { background: var(--primary); color: white; }
        
        .mode-quiz { border-color: var(--action); }
        .mode-quiz .icon-box { background: var(--action); color: white; }

        .icon-box {
            width: 60px; height: 60px; border-radius: 15px; display: flex; 
            justify-content: center; align-items: center; font-size: 2rem; flex-shrink: 0;
        }
        .mode-info h3 { margin: 0; font-size: 1.3rem; color: var(--text-main); }
        .mode-info p { margin: 5px 0 0; color: var(--text-light); font-size: 0.9rem; }

        /* --- 2. é ç¿’ç¸½è¡¨ (Grid) --- */
        .grid-header { text-align: center; margin-bottom: 20px; }
        .word-grid-container {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;
        }
        
        .grid-item {
            background: #fff; border: 2px solid #e0e0e0; border-radius: 15px;
            padding: 20px 5px; text-align: center; font-size: 1.3rem; font-weight: 800;
            color: #bdc3c7; /* æœªè®€å‘ˆç¾ç°è‰² */
            cursor: pointer; transition: 0.2s; box-shadow: 0 4px 0 #e0e0e0;
        }
        .grid-item:active { transform: translateY(4px); box-shadow: none; }

        /* çœ‹éçš„ç‹€æ…‹ - é®®è±”ç¶  */
        .grid-item.viewed {
            background-color: white;
            border-color: var(--primary);
            color: var(--primary-dark);
            box-shadow: 0 4px 0 var(--primary);
        }
        /* åŠ ä¸Šä¸€å€‹å°å‹¾å‹¾ */
        .grid-item.viewed::after {
            content: "âœ¨"; position: absolute; top: 5px; right: 5px; font-size: 0.8rem;
        }

        /* --- 3. å–®å­—å¡ (Flashcard) --- */
        .word-card {
            background: #fff; border: 3px solid var(--primary); border-radius: 25px;
            padding: 30px 20px; text-align: center; margin-bottom: 25px; 
            box-shadow: 0 8px 0 #e8f5e9;
        }
        .wc-word { font-size: 3.5rem; font-weight: 900; color: var(--text-main); margin-bottom: 15px; word-break: break-word; line-height: 1.1; }
        .wc-sentence { 
            font-size: 1.3rem; color: #555; background: #f9f9f9; 
            padding: 15px; border-radius: 12px; text-align: left; 
            border-left: 5px solid var(--action);
        }

        /* --- 4. æ¸¬é©—å€ (Quiz) --- */
        .quiz-status { 
            display: flex; justify-content: space-between; font-weight: bold; color: var(--primary); 
            background: #e8f8f5; padding: 10px 15px; border-radius: 30px; margin-bottom: 20px;
        }

        .audio-area { text-align: center; margin-bottom: 25px; }
        /* æ©˜è‰²å¤§æŒ‰éˆ•ï¼šè¦–è¦ºé‡å¿ƒ */
        .btn-audio-big {
            width: 90px; height: 90px; border-radius: 50%; background: var(--action);
            border: 4px solid #fff; font-size: 2.5rem; cursor: pointer; color: #fff;
            box-shadow: 0 6px 0 #d35400, 0 0 0 4px var(--action); 
            transition: 0.1s; animation: pulse 2s infinite;
        }
        .btn-audio-big:active { transform: translateY(4px); box-shadow: 0 2px 0 #d35400, 0 0 0 4px var(--action); }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        .quiz-input {
            width: 100%; padding: 15px; font-size: 1.8rem; text-align: center; font-weight: bold;
            border: 3px solid #e0e0e0; border-radius: 15px; outline: none;
            margin-bottom: 10px; color: var(--text-main); background: #fff;
            transition: 0.3s;
        }
        /* è¼¸å…¥æ¡†èšç„¦æ™‚è®Šæ©˜è‰² */
        .quiz-input:focus { border-color: var(--action); box-shadow: 0 0 0 4px rgba(243, 156, 18, 0.2); }
        
        .feedback-area {
            min-height: 50px; text-align: center; font-weight: 800; margin-bottom: 15px; font-size: 1.3rem;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .correct { color: var(--primary); background: #eafaf1; padding: 10px; border-radius: 10px; width: 100%; }
        .wrong { color: var(--wrong); background: #fadbd8; padding: 10px; border-radius: 10px; width: 100%; }

        /* é€šç”¨æŒ‰éˆ• */
        .btn-main {
            width: 100%; padding: 15px; background: var(--primary); color: white;
            border: none; border-radius: 50px; font-size: 1.2rem; font-weight: 900;
            cursor: pointer; box-shadow: 0 5px 0 var(--primary-dark); transition: 0.1s;
            margin-bottom: 10px;
        }
        .btn-main:active { transform: translateY(4px); box-shadow: none; }
        
        /* å¡ç‰‡ä¸Šçš„å°å–‡å­ */
        .btn-audio-small {
            width: 50px; height: 50px; border-radius: 50%; background: var(--action);
            border: none; font-size: 1.5rem; cursor: pointer; color: #fff;
            box-shadow: 0 4px 0 #d35400; margin: 0 auto 20px; display: block;
        }
        .btn-audio-small:active { transform: translateY(3px); box-shadow: none; }

        /* å°èˆªå°æŒ‰éˆ• */
        .btn-nav-group { display: flex; gap: 10px; justify-content: center; }
        .btn-small {
            padding: 12px 25px; background: #fff; border: 2px solid #eee; border-radius: 30px;
            color: var(--text-light); cursor: pointer; font-weight: bold; font-size: 1rem;
            box-shadow: 0 4px 0 #eee; flex: 1;
        }
        .btn-small:active { transform: translateY(4px); box-shadow: none; }

    </style>
</head>
<body>

<div class="app-container">
    <header>
        <span>ğŸŒ± å­¸ç”Ÿç·´ç¿’å€</span>
        <button class="home-btn" onclick="goHome()">ğŸ  å›é¦–é </button>
    </header>

    <div id="homeScreen" class="screen active">
        <div class="welcome-area">
            <span class="welcome-emoji">ğŸ’</span>
            <h2 style="color:var(--text-main); margin:0;">Happy Learning!</h2>
            <p style="color:#aaa; margin-top:5px;">ä»Šå¤©æƒ³æŒ‘æˆ°å“ªä¸€é—œï¼Ÿ</p>
        </div>

        <div class="session-select-area">
            <label style="display:block; margin-bottom:10px; color:var(--text-main); font-weight:bold; font-size:1.1rem;">ğŸ“ ç¬¬ä¸€æ­¥ï¼šé¸æ“‡å–®å…ƒ</label>
            <select id="sessionSelect"></select>
        </div>

        <div class="menu-grid">
            <div class="mode-card mode-review" onclick="startReviewGrid()">
                <div class="icon-box">ğŸ“–</div>
                <div class="mode-info">
                    <h3>å–®å­—é ç¿’</h3>
                    <p>é»æ“Šæ ¼å­çœ‹å–®å­—å¡</p>
                </div>
            </div>
            <div class="mode-card mode-quiz" onclick="startQuiz()">
                <div class="icon-box">âœï¸</div>
                <div class="mode-info">
                    <h3>è½å¯«æŒ‘æˆ°</h3>
                    <p>è½é¡Œç›® (å­—-å¥-å­—) æ‹¼å¯«</p>
                </div>
            </div>
        </div>
        <div id="loadStatus" style="text-align:center; margin-top:30px; color:#ccc; font-size:0.8rem;"></div>
    </div>

    <div id="gridScreen" class="screen">
        <div class="grid-header">
            <h3 style="color:var(--text-main); margin:0;">é€™å€‹å–®å…ƒçš„å–®å­—</h3>
            <p style="color:#999; font-size:0.9rem; margin-top:5px;">é»æ“Šè®Šè‰²ä»£è¡¨çœ‹éå›‰ï¼</p>
        </div>
        
        <div id="wordGrid" class="word-grid-container"></div>

        <button class="btn-small" onclick="goHome()" style="width:100%; margin-top:30px;">â¬… å›ä¸Šä¸€é </button>
    </div>

    <div id="flashcardScreen" class="screen">
        <div class="word-card">
            <div class="wc-word" id="revWord">...</div>
            <button class="btn-audio-small" onclick="playWord()">ğŸ”Š</button>
            <div class="wc-sentence" id="revSentence">...</div>
        </div>

        <button class="btn-main" onclick="backToGrid()" style="background:var(--text-main); box-shadow:0 5px 0 #17202a;">ğŸ†— çœ‹å®Œäº†ï¼Œå›ç¸½è¡¨</button>
        
        <div style="display:flex; justify-content:space-between; margin-top:10px; gap:10px;">
            <button class="btn-small" onclick="prevReview()">â¬… ä¸Šä¸€å€‹</button>
            <button class="btn-small" onclick="nextReview()">ä¸‹ä¸€å€‹ â¡</button>
        </div>
    </div>

    <div id="quizScreen" class="screen">
        <div class="quiz-status">
            <span>ğŸš€ æŒ‘æˆ°ä¸­</span>
            <span><span id="quizIndex">1</span> / <span id="quizTotal">10</span></span>
        </div>
        
        <div class="audio-area">
            <div style="font-size:1rem; color:#888; margin-bottom:15px;">é»æ“Šå¤§æŒ‰éˆ•è½é¡Œç›®</div>
            <button class="btn-audio-big" onclick="playQuestionSequence()">ğŸ”Š</button>
            <div style="font-size:0.85rem; color:#aaa; margin-top:10px; font-weight:bold;">( å–®å­— â¡ ä¾‹å¥ â¡ å–®å­— )</div>
        </div>

        <input type="text" id="userSpelling" class="quiz-input" placeholder="è¼¸å…¥å–®å­—..." autocomplete="off" autocapitalize="off">
        
        <div id="quizFeedback" class="feedback-area"></div>

        <button class="btn-main" onclick="checkAnswer()" style="background:var(--action); box-shadow:0 5px 0 #d35400;">âœ¨ é€å‡ºæª¢æŸ¥</button>
        
        <div style="display:flex; gap:10px; margin-top:10px;">
            <button class="btn-small" onclick="showAnswer()">ğŸ™ˆ å·çœ‹ç­”æ¡ˆ</button>
            <button class="btn-small" id="nextQuizBtn" onclick="nextQuiz()" style="display:none; background:var(--primary); color:white; border-color:var(--primary);">ä¸‹ä¸€é¡Œ â¡</button>
        </div>
    </div>

    <div id="finishScreen" class="screen" style="text-align:center;">
        <div style="font-size:6rem; margin-top:40px; filter:drop-shadow(0 10px 0 #eee);">ğŸ†</div>
        <h2 style="color:var(--primary); font-size:2rem; margin:20px 0 10px;">å¤ªæ£’äº†ï¼</h2>
        <p style="color:#555; font-size:1.2rem;">ä½ å®Œæˆäº†æ‰€æœ‰çš„ç·´ç¿’ï¼</p>
        <button class="btn-main" onclick="goHome()" style="margin-top:30px;">ğŸ  å›é¦–é </button>
    </div>

</div>

<script src="words.js"></script>
<script>
    let db = [], currentList = [], currentIndex = 0;
    let viewedIndices = new Set(); // è¨˜éŒ„å·²è®€å–®å­— (ç”¨å–®å­—å…§å®¹ç•¶key)

    window.onload = function() {
        if (typeof masterWordList !== 'undefined') {
            db = masterWordList;
            initSessions();
            document.getElementById('loadStatus').innerText = "v2.1 Ready";
        } else {
            document.getElementById('loadStatus').innerHTML = "<span style='color:red'>âš ï¸ æ‰¾ä¸åˆ° words.js</span>";
        }
    };

    function initSessions() {
        const sessions = [...new Set(db.map(x => x.session))].sort((a,b)=>a-b);
        const sel = document.getElementById('sessionSelect');
        sessions.forEach(s => {
            const opt = document.createElement('option');
            opt.value = s;
            opt.innerText = `ç¬¬ ${s} å–®å…ƒ`;
            sel.appendChild(opt);
        });
    }

    function goHome() { showScreen('homeScreen'); }
    function showScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    function prepareList() {
        const session = parseInt(document.getElementById('sessionSelect').value);
        currentList = db.filter(x => x.session === session);
        currentIndex = 0;
    }

    // Grid é‚è¼¯
    function startReviewGrid() {
        prepareList();
        if(currentList.length === 0) { alert("æ­¤å–®å…ƒç„¡å–®å­—"); return; }
        renderGrid();
        showScreen('gridScreen');
    }

    function renderGrid() {
        const container = document.getElementById('wordGrid');
        container.innerHTML = "";
        currentList.forEach((item, index) => {
            const div = document.createElement('div');
            div.className = 'grid-item';
            div.innerText = item.word;
            if (viewedIndices.has(item.word)) div.classList.add('viewed');
            div.onclick = () => jumpToCard(index);
            container.appendChild(div);
        });
    }

    function jumpToCard(index) {
        currentIndex = index;
        showScreen('flashcardScreen');
        updateReviewCard();
        markAsViewed();
    }

    function backToGrid() {
        renderGrid();
        showScreen('gridScreen');
    }

    function markAsViewed() {
        const item = currentList[currentIndex];
        viewedIndices.add(item.word);
    }

    // Flashcard é‚è¼¯
    function updateReviewCard() {
        const item = currentList[currentIndex];
        document.getElementById('revWord').innerText = item.word;
        document.getElementById('revSentence').innerText = item.sentence;
        markAsViewed();
    }
    function playWord() { speak(currentList[currentIndex].word); }
    function prevReview() { if(currentIndex > 0) { currentIndex--; updateReviewCard(); } }
    function nextReview() { 
        if(currentIndex < currentList.length - 1) { currentIndex++; updateReviewCard(); }
        else { if(confirm("çœ‹å®Œå›‰ï¼å›ç¸½è¡¨å—ï¼Ÿ")) backToGrid(); }
    }

    // Quiz é‚è¼¯
    function startQuiz() {
        prepareList();
        currentList.sort(() => Math.random() - 0.5);
        if(currentList.length === 0) { alert("ç„¡å–®å­—"); return; }
        showScreen('quizScreen');
        loadQuizQuestion();
    }

    function loadQuizQuestion() {
        document.getElementById('quizIndex').innerText = currentIndex + 1;
        document.getElementById('quizTotal').innerText = currentList.length;
        document.getElementById('userSpelling').value = "";
        document.getElementById('quizFeedback').innerText = "";
        document.getElementById('quizFeedback').className = "feedback-area";
        document.getElementById('nextQuizBtn').style.display = 'none';
        
        // èšç„¦è¼¸å…¥æ¡†
        setTimeout(() => { document.getElementById('userSpelling').focus(); playQuestionSequence(); }, 500);
    }

    function playQuestionSequence() {
        const item = currentList[currentIndex];
        window.speechSynthesis.cancel();
        
        const u1 = new SpeechSynthesisUtterance(item.word); u1.lang = 'en-US'; u1.rate = 0.8;
        const u2 = new SpeechSynthesisUtterance(item.sentence); u2.lang = 'en-US'; u2.rate = 0.8;
        const u3 = new SpeechSynthesisUtterance(item.word); u3.lang = 'en-US'; u3.rate = 0.8;

        window.speechSynthesis.speak(u1);
        window.speechSynthesis.speak(u2);
        window.speechSynthesis.speak(u3);
    }

    function checkAnswer() {
        const userAns = document.getElementById('userSpelling').value.trim().toLowerCase();
        const correctAns = currentList[currentIndex].word.trim().toLowerCase();
        const feedback = document.getElementById('quizFeedback');

        if (userAns === correctAns) {
            feedback.innerHTML = "âœ… ç­”å°äº†ï¼";
            feedback.className = "feedback-area correct";
            playDing();
            document.getElementById('nextQuizBtn').style.display = 'block';
        } else {
            feedback.innerHTML = "âŒ å†è©¦ä¸€æ¬¡";
            feedback.className = "feedback-area wrong";
            speak(currentList[currentIndex].word);
        }
    }

    function showAnswer() {
        const item = currentList[currentIndex];
        document.getElementById('userSpelling').value = item.word;
        document.getElementById('quizFeedback').innerHTML = `ğŸ’¡ ${item.word}`;
        document.getElementById('nextQuizBtn').style.display = 'block';
    }

    function nextQuiz() {
        currentIndex++;
        if (currentIndex < currentList.length) loadQuizQuestion();
        else showScreen('finishScreen');
    }

    function speak(text) {
        window.speechSynthesis.cancel();
        const u = new SpeechSynthesisUtterance(text); u.lang = 'en-US'; u.rate = 0.8;
        window.speechSynthesis.speak(u);
    }

    function playDing() {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const osc = ctx.createOscillator(); const gain = ctx.createGain();
        osc.connect(gain); gain.connect(ctx.destination);
        osc.frequency.setValueAtTime(800, ctx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(400, ctx.currentTime + 0.3);
        gain.gain.setValueAtTime(0.3, ctx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
        osc.start(); osc.stop(ctx.currentTime + 0.3);
    }
</script>
</body>
</html>